# n8nìœ¼ë¡œ êµ¬ê¸€ ë‚˜ë…¸ë°”ë‚˜ë‚˜(Gemini 2.5 Flash) ì´ë¯¸ì§€ í¸ì§‘ ìë™í™” ê°€ì´ë“œ

![ë‚˜ë…¸ë°”ë‚˜ë‚˜ ìë™í™”](./thumbnail.png)

êµ¬ê¸€ì˜ ìµœì‹  AI ëª¨ë¸ì¸ Gemini 2.5 Flash(ë‚˜ë…¸ë°”ë‚˜ë‚˜)ë¥¼ n8nê³¼ ì—°ê²°í•˜ì—¬ ì´ë¯¸ì§€ í¸ì§‘ë¶€í„° íŒŒì¼ ì—…ë¡œë“œê¹Œì§€ ì™„ì „ ìë™í™”í•˜ëŠ” ì‹œìŠ¤í…œ êµ¬ì¶• ê°€ì´ë“œì…ë‹ˆë‹¤.

## ëª©ì°¨

- [ë‚˜ë…¸ë°”ë‚˜ë‚˜ë€?](#ë‚˜ë…¸ë°”ë‚˜ë‚˜ë€)
- [OpenRouter ì†Œê°œ ë° ì„¤ì •](#openrouter-ì†Œê°œ-ë°-ì„¤ì •)
- [ì‹œìŠ¤í…œ ê°œìš”](#ì‹œìŠ¤í…œ-ê°œìš”)
- [ì‚¬ì „ ì¤€ë¹„ì‚¬í•­](#ì‚¬ì „-ì¤€ë¹„ì‚¬í•­)
- [ì›Œí¬í”Œë¡œìš° êµ¬ì¶• ë‹¨ê³„](#ì›Œí¬í”Œë¡œìš°-êµ¬ì¶•-ë‹¨ê³„)
  - [1. í¼ ì…ë ¥ ì„¤ì •](#1-í¼-ì…ë ¥-ì„¤ì •)
  - [2. ì´ë¯¸ì§€ ë°ì´í„° ì¶”ì¶œ](#2-ì´ë¯¸ì§€-ë°ì´í„°-ì¶”ì¶œ)
  - [3. ë°ì´í„° ë³‘í•©](#3-ë°ì´í„°-ë³‘í•©)
  - [4. ì´ë¯¸ì§€ ì¡´ì¬ ì—¬ë¶€ í™•ì¸](#4-ì´ë¯¸ì§€-ì¡´ì¬-ì—¬ë¶€-í™•ì¸)
  - [5. AI í”„ë¡¬í”„íŠ¸ ìƒì„±](#5-ai-í”„ë¡¬í”„íŠ¸-ìƒì„±)
  - [6. ë‚˜ë…¸ë°”ë‚˜ë‚˜ ì—°ê²°](#6-ë‚˜ë…¸ë°”ë‚˜ë‚˜-ì—°ê²°)
  - [7. ê²°ê³¼ ì´ë¯¸ì§€ ì²˜ë¦¬](#7-ê²°ê³¼-ì´ë¯¸ì§€-ì²˜ë¦¬)
  - [8. êµ¬ê¸€ ë“œë¼ì´ë¸Œ ì—…ë¡œë“œ](#8-êµ¬ê¸€-ë“œë¼ì´ë¸Œ-ì—…ë¡œë“œ)
- [í…ŒìŠ¤íŠ¸ ë° í™œìš©](#í…ŒìŠ¤íŠ¸-ë°-í™œìš©)
- [ì£¼ì˜ì‚¬í•­ ë° íŒ](#ì£¼ì˜ì‚¬í•­-ë°-íŒ)

## ë‚˜ë…¸ë°”ë‚˜ë‚˜ë€?

**ë‚˜ë…¸ë°”ë‚˜ë‚˜**ëŠ” êµ¬ê¸€ì˜ Gemini 2.5 Flash Image ëª¨ë¸ì˜ ë³„ëª…ìœ¼ë¡œ, ìµœê·¼ AI ì—…ê³„ì—ì„œ ê°€ì¥ ì£¼ëª©ë°›ê³  ìˆëŠ” ì´ë¯¸ì§€ í¸ì§‘ ëª¨ë¸ì…ë‹ˆë‹¤.

### ì£¼ìš” íŠ¹ì§•
- **ë›°ì–´ë‚œ ì„±ëŠ¥**: ê¸°ì¡´ ì´ë¯¸ì§€ ìƒì„± ëª¨ë¸ ëŒ€ë¹„ ì›”ë“±í•œ ë²¤ì¹˜ë§ˆí¬ ìŠ¤ì½”ì–´
- **ë¹ ë¥¸ ì†ë„**: ChatGPTë³´ë‹¤ ë¹ ë¥¸ ì²˜ë¦¬ ì†ë„
- **ìš°ìˆ˜í•œ í’ˆì§ˆ**: AI ì»¤ë®¤ë‹ˆí‹°ì—ì„œ ë†’ì€ í‰ê°€ë¥¼ ë°›ëŠ” ì´ë¯¸ì§€ í¸ì§‘ í’ˆì§ˆ
- **ìì—°ìŠ¤ëŸ¬ìš´ í¸ì§‘**: ê¸°ì¡´ ì´ë¯¸ì§€ì˜ ìŠ¤íƒ€ì¼ ë³€ê²½, ë ˆí¼ëŸ°ìŠ¤ ê¸°ë°˜ ìƒˆ ì´ë¯¸ì§€ ìƒì„± ë“±

### ì ‘ê·¼ ë°©ë²•
- **Google AI Studio**: ë¬´ë£Œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
- **Google API**: ìœ ë£Œ ì„œë¹„ìŠ¤
- **OpenRouter**: í˜„ì¬ ë¬´ë£Œë¡œ ì œê³µ ì¤‘

## OpenRouter ì†Œê°œ ë° ì„¤ì •

[OpenRouter](https://openrouter.ai/)ëŠ” ë‹¤ì–‘í•œ AI ëª¨ë¸ì„ í•˜ë‚˜ì˜ í”Œë«í¼ì—ì„œ í†µí•© ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. AI ëª¨ë¸ë“¤ì˜ êµ¬ê¸€í”Œë ˆì´/ì•±ìŠ¤í† ì–´ ê°™ì€ ê°œë…ì´ë¼ê³  ìƒê°í•˜ì‹œë©´ ë©ë‹ˆë‹¤.

### OpenRouter ì„¤ì • ë°©ë²•

1. **íšŒì›ê°€ì…**
   - [OpenRouter ì›¹ì‚¬ì´íŠ¸](https://openrouter.ai/)ì—ì„œ ê³„ì • ìƒì„±

2. **API í‚¤ ë°œê¸‰**
   - ëŒ€ì‹œë³´ë“œì—ì„œ API í‚¤ ìƒì„±
   - ìƒì„±ëœ í‚¤ë¥¼ ì•ˆì „í•˜ê²Œ ì €ì¥

3. **ëª¨ë¸ í™•ì¸**
   - `google/gemini-2.5-flash-image-preview:free` ëª¨ë¸ì´ ë¬´ë£Œë¡œ ì œê³µë˜ëŠ”ì§€ í™•ì¸

## ì‹œìŠ¤í…œ ê°œìš”

ì´ ìë™í™” ì‹œìŠ¤í…œì€ ë‹¤ìŒê³¼ ê°™ì€ í”„ë¡œì„¸ìŠ¤ë¡œ ì‘ë™í•©ë‹ˆë‹¤:

1. **ì…ë ¥**: í¼ì„ í†µí•´ ë ˆí¼ëŸ°ìŠ¤ ì´ë¯¸ì§€, ì›ë³¸ ì´ë¯¸ì§€, í¸ì§‘ ìš”ì²­ì‚¬í•­ ì…ë ¥
2. **í”„ë¡¬í”„íŠ¸ ìµœì í™”**: AIê°€ ë‚˜ë…¸ë°”ë‚˜ë‚˜ì— ìµœì í™”ëœ í¸ì§‘ í”„ë¡¬í”„íŠ¸ ìƒì„±
3. **ì´ë¯¸ì§€ í¸ì§‘**: ë‚˜ë…¸ë°”ë‚˜ë‚˜ê°€ ì´ë¯¸ì§€ í¸ì§‘ ìˆ˜í–‰
4. **íŒŒì¼ ì²˜ë¦¬**: í¸ì§‘ëœ ì´ë¯¸ì§€ë¥¼ íŒŒì¼ë¡œ ë³€í™˜
5. **ì—…ë¡œë“œ**: êµ¬ê¸€ ë“œë¼ì´ë¸Œì— ìµœì¢… ê²°ê³¼ë¬¼ ìë™ ì—…ë¡œë“œ

## ì‚¬ì „ ì¤€ë¹„ì‚¬í•­

### 1. API í‚¤ ì¤€ë¹„
- **OpenRouter API í‚¤**: OpenRouterì—ì„œ ë°œê¸‰ë°›ì€ API í‚¤
- **OpenAI API í‚¤**: GPT-4.1 ëª¨ë¸ ì‚¬ìš©ì„ ìœ„í•œ API í‚¤ (í”„ë¡¬í”„íŠ¸ ìµœì í™”ìš©)

### 2. Google ì„œë¹„ìŠ¤ ì„¤ì •
- **Google Drive API**: Google Cloud Consoleì—ì„œ Drive API í™œì„±í™”
- **OAuth ì¸ì¦**: Google Drive ì ‘ê·¼ì„ ìœ„í•œ OAuth ì„¤ì •
- [Oauth ì„¤ì • ì°¸ê³  ì˜ìƒ](https://youtu.be/VlsgHC5xkPA?si=p9pJRH7QsCU4RM5D&t=593)


### 3. n8n í™˜ê²½
- n8nì´ ë¡œì»¬ ë˜ëŠ” ì„œë²„ì— ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤

## ì›Œí¬í”Œë¡œìš° êµ¬ì¶• ë‹¨ê³„

![ë‚˜ë…¸ë°”ë‚˜ë‚˜ ì›Œí¬í”Œë¡œìš°](./workflow-ex.png)

### 1. í¼ ì…ë ¥ ì„¤ì •

**Form íŠ¸ë¦¬ê±° ë…¸ë“œ ì¶”ê°€**
- Form Title: "ë‚˜ë…¸ë°”ë‚˜ë‚˜ ì´ë¯¸ì§€ í¸ì§‘"
- Form Description: "ì´ë¯¸ì§€ í¸ì§‘ì— í•„ìš”í•œ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"

**Form Elements ì„¤ì •**
```
Reference Image (íŒŒì¼): ë ˆí¼ëŸ°ìŠ¤ ì´ë¯¸ì§€ ì—…ë¡œë“œ [ì„ íƒì‚¬í•­]
Original Image (íŒŒì¼): í¸ì§‘í•  ì›ë³¸ ì´ë¯¸ì§€ ì—…ë¡œë“œ [ì„ íƒì‚¬í•­]
Request (í…ìŠ¤íŠ¸): í¸ì§‘ ìš”ì²­ì‚¬í•­ ì…ë ¥ [í•„ìˆ˜]
```

### 2. ì´ë¯¸ì§€ ë°ì´í„° ì¶”ì¶œ

**ì²« ë²ˆì§¸ Extract from File ë…¸ë“œ (ë ˆí¼ëŸ°ìŠ¤ ì´ë¯¸ì§€ìš©)**
- Binary Property: `Reference_image`
- Extract to: `reference_data`
- Settings > Always Output Data: í™œì„±í™”

**ë‘ ë²ˆì§¸ Extract from File ë…¸ë“œ (ì›ë³¸ ì´ë¯¸ì§€ìš©)**
- Binary Property: `Original_image`
- Extract to: `original_data`
- Settings > Always Output Data: í™œì„±í™”

### 3. ë°ì´í„° ë³‘í•©

**Merge ë…¸ë“œ ì¶”ê°€**
- Mode: Combine
- Combine: Position
- ë‘ Extract from File ë…¸ë“œì˜ ì¶œë ¥ì„ ë³‘í•©

### 4. ì´ë¯¸ì§€ ì¡´ì¬ ì—¬ë¶€ í™•ì¸

**Edit Fields ë…¸ë“œ ì¶”ê°€**
ìƒˆë¡œìš´ í•„ë“œ ìƒì„±:
- í•„ë“œëª…: `image_exist`
- ê°’:
```javascript
{{
  $('Merge').item.json.reference_data
    ? "reference image exists"
    : ( ($('Merge').item.json.Original_data || $('Merge').item.json.original_data)
        ? "source image exists"
        : "image does not exist"
      )
}}
```

### 5. AI í”„ë¡¬í”„íŠ¸ ìƒì„±

**OpenAI ë…¸ë“œ ì¶”ê°€ (GPT-4.1 ì‚¬ìš©)**

**ì‹œìŠ¤í…œ ë©”ì‹œì§€:**
```
You are an image generation/editing prompt engineer. Your job is to output exactly ONE English prompt text.
The prompt should be written as a natural paragraph (or a few sentences), not as separated sections.
However, you must incorporate the key aspects of the template when relevant: goal, input resources, scene description, style/reference, composition/camera, lighting/mood, edit instructions, output specs, and negative prompts.
Only include elements that are necessary; omit missing ones naturally.
Do not output explanations, markdown, or quotation marks.

Branching rules:

Case 1 (reference image exists): Write a prompt that edits the source image to match the style, mood, colors, and composition of the reference image. Mention that the reference image guides the overall style transfer.

Case 2 (source image exists): Write a prompt that edits the source image according to the text instructions, describing the intended outcome clearly.

Case 3 (image does not exist): Write a prompt that creates a new image directly based on the text instructions. Formulate it as a descriptive generation prompt rather than an edit.

Important:

Always add a short negative instruction like: "Avoid distorted fingers, broken text, or unwanted artifacts."

Output only the final natural-language prompt, nothing else.
```

**ìœ ì € ë©”ì‹œì§€:**
```
Generate a single English image generation/editing prompt based on the following form inputs. 
Follow the branching rules from the system prompt. 
The output must be a natural paragraph (not separated by sections) but should include the relevant aspects if available.
Output only the final structured prompt text.

- image_availability: {{ $json.image_exist }}
- edit_instructions_text: {{ $('On form submission').item.json.Request }}
```

### 6. ë‚˜ë…¸ë°”ë‚˜ë‚˜ ì—°ê²°

**Code ë…¸ë“œ ì¶”ê°€ (ìœ ì—°í•œ ìš”ì²­ ì²˜ë¦¬)**
```javascript
// Code node: Run Once for All Items / JavaScript

// 1) Read the user prompt (fallback if missing)
const text =
  ($json?.message && $json.message.content) ||
  "Edit the source image using reference style if available. Avoid distorted fingers, broken text, or unwanted artifacts.";

// 2) Pull items from other nodes (ADJUST names!)
const refItems = $items("Extract from File", 0, 0);   // node with reference image
const srcItems = $items("Extract from File1", 0, 0);  // node with source image

const ref = refItems?.[0]?.json?.reference_data;
const refName = refItems?.[0]?.json?.fileName || "";  // optional filename for MIME detection

const src = srcItems?.[0]?.json?.Original_data ?? srcItems?.[0]?.json?.original_data;
const srcName = srcItems?.[0]?.json?.fileName || "";  // optional filename for MIME detection

// 3) Helper: guess MIME from filename or fallback
function guessMime(name, fallback = "image/png") {
  const lower = name.toLowerCase();
  if (lower.endsWith(".jpg") || lower.endsWith(".jpeg")) return "image/jpeg";
  if (lower.endsWith(".png")) return "image/png";
  if (lower.endsWith(".webp")) return "image/webp";
  return fallback;
}

// 4) Helper: wrap base64 in data URL
function toDataURL(b64, mime = "image/png") {
  if (!b64) return null;
  return b64.startsWith("data:") ? b64 : `data:${mime};base64,${b64}`;
}

// 5) Build content array
const contents = [{ type: "text", text }];

// add reference image if exists
if (ref) {
  contents.push({
    type: "image_url",
    image_url: { url: toDataURL(ref, guessMime(refName)) },
  });
}

// add source image if exists
if (src) {
  contents.push({
    type: "image_url",
    image_url: { url: toDataURL(src, guessMime(srcName)) },
  });
}

// 6) Final body
const body = {
  model: "google/gemini-2.5-flash-image-preview:free",
  messages: [
    {
      role: "user",
      content: contents,
    },
  ],
};

// 7) Return in n8n shape
return [{ json: body }];
```

**HTTP Request ë…¸ë“œ ì¶”ê°€**
- Method: `POST`
- URL: `https://openrouter.ai/api/v1/chat/completions`
- Authentication: Predefined Credential Typeìœ¼ë¡œ OpenRouter API í‚¤ ì„¤ì •
- Headers: `Content-Type: application/json`
- Body: `{{ $json }}`

### 7. ê²°ê³¼ ì´ë¯¸ì§€ ì²˜ë¦¬

**Edit Fields ë…¸ë“œ ì¶”ê°€ (base64 ë°ì´í„° ì¶”ì¶œ)**
- í•„ë“œëª…: `base`
- ê°’: `{{ $json.choices[0].message.images[0].image_url.url.split(",")[1] }}`

**Convert to File ë…¸ë“œ ì¶”ê°€**
- Mode: Text to Binary
- Input Data: `base`
- Binary Property Name: `data`

### 8. êµ¬ê¸€ ë“œë¼ì´ë¸Œ ì—…ë¡œë“œ

**Google Drive ë…¸ë“œ ì¶”ê°€**
- Operation: Upload a file
- Binary Data: `data`
- Name: `edited_image_{{ new Date().getTime() }}.png`
- Parents: ì›í•˜ëŠ” í´ë” ì„ íƒ

## í…ŒìŠ¤íŠ¸ ë° í™œìš©

### í…ŒìŠ¤íŠ¸ ì˜ˆì‹œ

1. **ìŠ¤íƒ€ì¼ ë³€í™˜**
   - ë ˆí¼ëŸ°ìŠ¤ ì´ë¯¸ì§€ì™€ ì›ë³¸ ì´ë¯¸ì§€ ì—…ë¡œë“œ
   - ìš”ì²­: "ë ˆí¼ëŸ°ìŠ¤ ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ë¡œ ì›ë³¸ ì´ë¯¸ì§€ë¥¼ ë³€í™˜í•´ì¤˜"

2. **ë°°ê²½ ë³€ê²½**
   - ì›ë³¸ ì´ë¯¸ì§€ë§Œ ì—…ë¡œë“œ
   - ìš”ì²­: "ë°°ê²½ì„ AI/ìë™í™”ì— ì–´ìš¸ë¦¬ëŠ” ëŠë‚Œìœ¼ë¡œ ë³€ê²½í•´ì¤˜"

3. **ìƒˆ ì´ë¯¸ì§€ ìƒì„±**
   - ì´ë¯¸ì§€ ì—†ì´ í…ìŠ¤íŠ¸ë§Œ ì…ë ¥
   - ìš”ì²­: "ì‹œë¯¼ê°œë°œì êµ¬ì”¨ ë¸Œëœë“œì˜ ë¡œê³ ë¥¼ ìƒì„±í•´ì¤˜"

### í™œìš© ì‚¬ë¡€

- **ë¸”ë¡œê·¸/SNS ì½˜í…ì¸ **: ì¼ê´€ëœ ë¸Œëœë“œ ì´ë¯¸ì§€ë¡œ ìë™ ë³€í™˜
- **ë§ˆì¼€íŒ… ìë£Œ**: ë‹¤ì–‘í•œ ìŠ¤íƒ€ì¼ì˜ ì œí’ˆ ì´ë¯¸ì§€ ìƒì„±
- **ì¸ë„¤ì¼ ì œì‘**: ìœ íŠœë¸Œ ë“± ì˜ìƒ í”Œë«í¼ìš© ì¸ë„¤ì¼ ìë™ ìƒì„±

## ì£¼ì˜ì‚¬í•­ ë° íŒ

### ì œí•œì‚¬í•­
1. **ì´ë¯¸ì§€ í¬ê¸°**: í° ì´ë¯¸ì§€ëŠ” context limitì— ê±¸ë¦´ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì ì ˆí•œ í¬ê¸°ë¡œ ë¦¬ì‚¬ì´ì§• ê¶Œì¥
2. **ì‚¬ìš©ëŸ‰ í•œë„**: ë¬´ë£Œ ë²„ì „ì—ëŠ” ì¼ì¼ ì‚¬ìš©ëŸ‰ ì œí•œì´ ìˆìŒ
3. **í•œê¸€ ì²˜ë¦¬**: í•œê¸€ í…ìŠ¤íŠ¸ê°€ í¬í•¨ëœ ì´ë¯¸ì§€ëŠ” ì œëŒ€ë¡œ ìƒì„±ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ

### ìµœì í™” íŒ
1. **í”„ë¡¬í”„íŠ¸ ì¡°ì •**: ê²°ê³¼ê°€ ë§Œì¡±ìŠ¤ëŸ½ì§€ ì•Šë‹¤ë©´ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ë¥¼ ìƒí™©ì— ë§ê²Œ ìˆ˜ì •
2. **ì¼€ì´ìŠ¤ë³„ ë¶„ë¦¬**: ìì£¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° Switch ë…¸ë“œë¡œ ì¼€ì´ìŠ¤ë³„ ì²˜ë¦¬ ê³ ë ¤
3. **ì˜¤ë¥˜ ì²˜ë¦¬**: HTTP Request ë…¸ë“œì— ì˜¤ë¥˜ ì²˜ë¦¬ ë¡œì§ ì¶”ê°€ ê¶Œì¥


ì´ ê°€ì´ë“œë¥¼ í†µí•´ êµ¬ê¸€ì˜ ë‚˜ë…¸ë°”ë‚˜ë‚˜ë¥¼ í™œìš©í•œ ê°•ë ¥í•œ ì´ë¯¸ì§€ í¸ì§‘ ìë™í™” ì‹œìŠ¤í…œì„ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°œì¸ ë¸Œëœë”©ë¶€í„° ë¹„ì¦ˆë‹ˆìŠ¤ ë§ˆì¼€íŒ…ê¹Œì§€, ë‹¤ì–‘í•œ ìš©ë„ë¡œ í™œìš©í•´ë³´ì„¸ìš”! ğŸš€

## ì°¸ê³  ìë£Œ

- [OpenRouter ê³µì‹ ì‚¬ì´íŠ¸](https://openrouter.ai/)
- [Google ë‚˜ë…¸ë°”ë‚˜ë‚˜ API ë¬¸ì„œ](https://ai.google.dev/gemini-api/docs/image-generation?hl=ko#image_generation_text-to-image)
- [n8n ê³µì‹ ë¬¸ì„œ](https://docs.n8n.io/)
